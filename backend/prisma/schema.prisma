generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Student {
  id          Int      @id @default(autoincrement())
  studentId   String   @unique
  firstName   String
  lastName    String
  email       String?
  phone       String?
  classId     Int?
  className   String?
  gender      String?
  birthDate   String?
  address     String?
  parentName  String?
  parentPhone String?
  status      String   @default("active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  attendance Attendance[]
  grades     Grade[]
}

model Teacher {
  id         Int      @id @default(autoincrement())
  teacherId  String   @unique
  firstName  String
  lastName   String
  email      String?
  phone      String?
  department String?
  subjects   String?
  position   String?
  education  String?
  status     String   @default("active")
  hireDate   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  classes Class[]
}

model Class {
  id           Int      @id @default(autoincrement())
  name         String
  level        String
  section      String
  year         Int
  teacherId    Int?
  teacher      Teacher? @relation(fields: [teacherId], references: [id])
  room         String?
  studentCount Int      @default(0)
  capacity     Int      @default(40)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  attendance Attendance[]
  grades     Grade[]
}

model Subject {
  id          Int      @id @default(autoincrement())
  code        String   @unique
  name        String
  department  String?
  credits     Int      @default(1)
  teacherId   Int?
  teacherName String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  grades Grade[]
}

model Attendance {
  id          Int      @id @default(autoincrement())
  studentId   Int
  student     Student  @relation(fields: [studentId], references: [id])
  classId     Int
  class       Class    @relation(fields: [classId], references: [id])
  date        String
  status      String
  note        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([studentId, date])
}

model Grade {
  id          Int      @id @default(autoincrement())
  studentId   Int
  student     Student  @relation(fields: [studentId], references: [id])
  subjectId   Int
  subject     Subject  @relation(fields: [subjectId], references: [id])
  classId     Int
  class       Class    @relation(fields: [classId], references: [id])
  semester    Int
  year        Int
  midterm     Float    @default(0)
  final       Float    @default(0)
  assignment  Float    @default(0)
  total       Float    @default(0)
  grade       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([studentId, subjectId, semester, year])
}

model Announcement {
  id        Int      @id @default(autoincrement())
  title     String
  content   String   @db.Text
  priority  String   @default("medium")
  category  String?
  author    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
