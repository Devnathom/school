<%- include('../partials/admin-header', { title, page, user }) %>

<div class="content-header">
  <div class="container-fluid">
    <h1><i class="fas fa-users mr-2"></i>จัดการผู้ใช้ทั้งหมด</h1>
  </div>
</div>

<section class="content">
  <div class="container-fluid">
    <div class="card">
      <div class="card-body">
        <table class="table table-bordered table-striped datatable">
          <thead>
            <tr>
              <th>ID</th>
              <th>ชื่อ</th>
              <th>อีเมล</th>
              <th>บทบาท</th>
              <th>โรงเรียน</th>
              <th>สถานะ</th>
              <th>เข้าใช้ล่าสุด</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(function(u) { %>
            <tr>
              <td><%= u.id %></td>
              <td><%= u.name %></td>
              <td><%= u.email %></td>
              <td>
                <% if (u.role === 'super_admin') { %>
                  <span class="badge badge-danger"><i class="fas fa-crown mr-1"></i>Super Admin</span>
                <% } else if (u.role === 'school_admin') { %>
                  <span class="badge badge-primary">Admin โรงเรียน</span>
                <% } else if (u.role === 'teacher') { %>
                  <span class="badge badge-success">ครู</span>
                <% } else { %>
                  <span class="badge badge-secondary">บุคลากร</span>
                <% } %>
              </td>
              <td><%= u.school_name || '-' %></td>
              <td>
                <span class="badge badge-<%= u.is_active ? 'success' : 'danger' %>">
                  <%= u.is_active ? 'ใช้งาน' : 'ปิดใช้งาน' %>
                </span>
              </td>
              <td><%= u.last_login ? new Date(u.last_login).toLocaleString('th-TH') : 'ยังไม่เคย' %></td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<%- include('../partials/footer', { success, error }) %>
