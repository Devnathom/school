<%- include('../partials/admin-header', { title, page, user }) %>

<div class="content-header">
  <div class="container-fluid">
    <h1><i class="fas fa-crown text-warning mr-2"></i>Super Admin Dashboard</h1>
  </div>
</div>

<section class="content">
  <div class="container-fluid">
    <!-- Stats -->
    <div class="row">
      <div class="col-lg-3 col-6">
        <div class="small-box bg-primary">
          <div class="inner">
            <h3><%= stats.schools %></h3>
            <p>โรงเรียนทั้งหมด</p>
          </div>
          <div class="icon"><i class="fas fa-school"></i></div>
          <a href="/admin/schools" class="small-box-footer">จัดการ <i class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>
      <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
          <div class="inner">
            <h3><%= stats.users %></h3>
            <p>ผู้ใช้ทั้งหมด</p>
          </div>
          <div class="icon"><i class="fas fa-users"></i></div>
          <a href="/admin/users" class="small-box-footer">จัดการ <i class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>
      <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
          <div class="inner">
            <h3><%= stats.students %></h3>
            <p>นักเรียนทั้งหมด</p>
          </div>
          <div class="icon"><i class="fas fa-user-graduate"></i></div>
        </div>
      </div>
      <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
          <div class="inner">
            <h3><%= stats.teachers %></h3>
            <p>ครูทั้งหมด</p>
          </div>
          <div class="icon"><i class="fas fa-chalkboard-teacher"></i></div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Recent Schools -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header bg-primary">
            <h3 class="card-title"><i class="fas fa-school mr-2"></i>โรงเรียนล่าสุด</h3>
            <div class="card-tools">
              <a href="/admin/schools" class="btn btn-sm btn-light">ดูทั้งหมด</a>
            </div>
          </div>
          <div class="card-body p-0">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>โรงเรียน</th>
                  <th>แพ็กเกจ</th>
                  <th>สถานะ</th>
                  <th>วันที่สมัคร</th>
                </tr>
              </thead>
              <tbody>
                <% recentSchools.forEach(function(s) { %>
                <tr>
                  <td>
                    <strong><%= s.name %></strong><br>
                    <small class="text-muted"><%= s.email %></small>
                  </td>
                  <td>
                    <span class="badge badge-<%= s.plan_slug === 'enterprise' ? 'danger' : s.plan_slug === 'pro' ? 'primary' : 'secondary' %>">
                      <%= s.plan_name %>
                    </span>
                  </td>
                  <td>
                    <span class="badge badge-<%= s.status === 'active' ? 'success' : s.status === 'pending' ? 'warning' : 'danger' %>">
                      <%= s.status === 'active' ? 'ใช้งาน' : s.status === 'pending' ? 'รอยืนยัน' : 'ระงับ' %>
                    </span>
                  </td>
                  <td><%= new Date(s.created_at).toLocaleDateString('th-TH') %></td>
                </tr>
                <% }); %>
                <% if (recentSchools.length === 0) { %>
                <tr><td colspan="4" class="text-center text-muted">ยังไม่มีโรงเรียน</td></tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Plans Summary -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header bg-success">
            <h3 class="card-title"><i class="fas fa-tags mr-2"></i>สรุปแพ็กเกจ</h3>
          </div>
          <div class="card-body">
            <% planStats.forEach(function(p) { %>
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <strong><%= p.name %></strong>
                <br><small class="text-muted">฿<%= p.price %>/เดือน</small>
              </div>
              <span class="badge badge-lg badge-primary"><%= p.school_count %> โรงเรียน</span>
            </div>
            <% }); %>
          </div>
          <div class="card-footer">
            <a href="/admin/plans" class="btn btn-success btn-block">จัดการแพ็กเกจ</a>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
          <div class="card-header bg-info">
            <h3 class="card-title"><i class="fas fa-bolt mr-2"></i>การดำเนินการด่วน</h3>
          </div>
          <div class="card-body">
            <a href="/admin/schools/add" class="btn btn-outline-primary btn-block mb-2">
              <i class="fas fa-plus mr-2"></i>เพิ่มโรงเรียนใหม่
            </a>
            <a href="/admin/users" class="btn btn-outline-success btn-block mb-2">
              <i class="fas fa-users mr-2"></i>จัดการผู้ใช้
            </a>
            <a href="/admin/reports" class="btn btn-outline-warning btn-block">
              <i class="fas fa-chart-bar mr-2"></i>รายงาน
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<%- include('../partials/footer', { success, error }) %>
