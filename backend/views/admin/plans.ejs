<%- include('../partials/admin-header', { title, page, user }) %>

<div class="content-header">
  <div class="container-fluid">
    <h1><i class="fas fa-tags mr-2"></i>จัดการแพ็กเกจ</h1>
  </div>
</div>

<section class="content">
  <div class="container-fluid">
    <div class="row">
      <% plans.forEach(function(p) { %>
      <div class="col-lg-4">
        <div class="card card-<%= p.slug === 'enterprise' ? 'danger' : p.slug === 'pro' ? 'primary' : 'secondary' %>">
          <div class="card-header">
            <h3 class="card-title"><%= p.name %></h3>
            <div class="card-tools">
              <span class="badge badge-light"><%= p.school_count || 0 %> โรงเรียน</span>
            </div>
          </div>
          <div class="card-body text-center">
            <h1 class="display-4">฿<%= p.price %></h1>
            <p class="text-muted">ต่อเดือน</p>
            <hr>
            <ul class="list-unstyled text-left">
              <li><i class="fas fa-user-graduate text-primary mr-2"></i>นักเรียนสูงสุด: <strong><%= p.max_students >= 9999 ? 'ไม่จำกัด' : p.max_students %></strong></li>
              <li><i class="fas fa-chalkboard-teacher text-success mr-2"></i>ครูสูงสุด: <strong><%= p.max_teachers >= 999 ? 'ไม่จำกัด' : p.max_teachers %></strong></li>
              <li><i class="fas fa-school text-warning mr-2"></i>ชั้นเรียนสูงสุด: <strong><%= p.max_classes >= 999 ? 'ไม่จำกัด' : p.max_classes %></strong></li>
            </ul>
            <hr>
            <small class="text-muted"><%= p.features %></small>
          </div>
          <div class="card-footer">
            <button class="btn btn-block btn-outline-primary" onclick="editPlan(<%= p.id %>, '<%= p.name %>', <%= p.price %>, <%= p.max_students %>, <%= p.max_teachers %>, <%= p.max_classes %>)">
              <i class="fas fa-edit mr-1"></i>แก้ไข
            </button>
          </div>
        </div>
      </div>
      <% }); %>
    </div>
  </div>
</section>

<!-- Edit Plan Modal -->
<div class="modal fade" id="editPlanModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <form action="/admin/plans/update" method="POST">
        <input type="hidden" name="id" id="editPlanId">
        <div class="modal-header bg-primary">
          <h5 class="modal-title text-white">แก้ไขแพ็กเกจ</h5>
          <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>ชื่อแพ็กเกจ</label>
            <input type="text" name="name" id="editPlanName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>ราคา (บาท/เดือน)</label>
            <input type="number" name="price" id="editPlanPrice" class="form-control" min="0" required>
          </div>
          <div class="form-group">
            <label>จำนวนนักเรียนสูงสุด</label>
            <input type="number" name="max_students" id="editPlanStudents" class="form-control" min="1" required>
          </div>
          <div class="form-group">
            <label>จำนวนครูสูงสุด</label>
            <input type="number" name="max_teachers" id="editPlanTeachers" class="form-control" min="1" required>
          </div>
          <div class="form-group">
            <label>จำนวนชั้นเรียนสูงสุด</label>
            <input type="number" name="max_classes" id="editPlanClasses" class="form-control" min="1" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">ยกเลิก</button>
          <button type="submit" class="btn btn-primary">บันทึก</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function editPlan(id, name, price, students, teachers, classes) {
  $('#editPlanId').val(id);
  $('#editPlanName').val(name);
  $('#editPlanPrice').val(price);
  $('#editPlanStudents').val(students);
  $('#editPlanTeachers').val(teachers);
  $('#editPlanClasses').val(classes);
  $('#editPlanModal').modal('show');
}
</script>

<%- include('../partials/footer', { success, error }) %>
